//Copyright (c) 2018 Crystalline Technologies
//The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
export const Json2Html = {transform:function(t,e,n){var i={events:[],html:""},r={events:!1};if(r=Json2Html._extend(r,n),void 0!==e||void 0!==t){var s="string"==typeof t?JSON.parse(t):t;i=Json2Html._transform(s,e,r)}return r.events?i:i.html},_extend:function(t,e){var n={};for(var i in t)n[i]=t[i];for(var i in e)n[i]=e[i];return n},_append:function(t,e){var n={html:"",event:[]};return void 0!==t&&void 0!==e&&(n.html=t.html+e.html,n.events=t.events.concat(e.events)),n},_isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},_transform:function(t,e,n){var i={events:[],html:""};if(Json2Html._isArray(t))for(var r=t.length,s=0;s<r;++s)i=Json2Html._append(i,Json2Html._apply(t[s],e,s,n));else"object"==typeof t&&(i=Json2Html._append(i,Json2Html._apply(t,e,void 0,n)));return i},_apply:function(t,e,n,i){var r={events:[],html:""};if(Json2Html._isArray(e))for(var s=e.length,o=0;o<s;++o)r=Json2Html._append(r,Json2Html._apply(t,e[o],n,i));else if("object"==typeof e){var l="<>";if(void 0===e[l]&&(l="tag"),void 0!==e[l]){var a=Json2Html._getValue(t,e,l,n);r.html+="<"+a;var c,f={events:[],html:""};for(var u in e)switch(u){case"tag":case"<>":break;case"text":var m=e[u];if(Json2Html._isArray(m));else if("function"==typeof m){var d=m.call(t,t,n);if(!Json2Html._isArray(d))switch(typeof d){case"function":case"undefined":case"object":break;default:f.html+=Json2Html.toText(d)}}else c=Json2Html.toText(Json2Html._getValue(t,e,u,n));break;case"children":case"html":m=e[u];if(Json2Html._isArray(m))f=Json2Html._append(f,Json2Html._apply(t,m,n,i));else if("function"==typeof m){d=m.call(t,t,n);if(!Json2Html._isArray(d))switch(typeof d){case"object":void 0!==d.html&&void 0!==d.events&&(f=Json2Html._append(f,d));break;case"function":case"undefined":break;default:f.html+=d}}else c=Json2Html._getValue(t,e,u,n);break;default:var h=!1;if(2<u.length&&"on"==u.substring(0,2).toLowerCase()){if(i.events){var p={action:e[u],obj:t,data:i.eventData,index:n},v=Json2Html._guid();r.events[r.events.length]={id:v,type:u.substring(2),data:p},r.html+=" Json2Html-event-id-"+u.substring(2)+"='"+v+"'"}h=!0}if(!h){var _,g=Json2Html._getValue(t,e,u,n);if(void 0!==g)_="string"==typeof g?'"'+g.replace(/"/g,"&quot;")+'"':g,r.html+=" "+u+"="+_}}r.html+=">",c&&(r.html+=c),(r=Json2Html._append(r,f)).html+="</"+a+">"}}return r},_guid:function(){var t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return t()+t()+"-"+t()+t()+"-"+t()+t()},_getValue:function(l,t,e,n){var i=t[e],r=typeof i;return"function"===r?i.call(l,l,n):"string"===r?new Json2Html._tokenizer([/\$\{([^\}\{]+)\}/],function(t,e,n){return e?t.replace(n,function(t,e){for(var n=e.split("."),i=l,r="",s=n.length,o=0;o<s;++o){if(0<n[o].length)if(null==(i=i[n[o]]))break}return null!=i&&(r=i),r}):t}).parse(i).join(""):i},toText:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&#39;").replace(/\//g,"&#x2F;")},_tokenizer:function(t,e){if(!(this instanceof Json2Html._tokenizer))return new Json2Html._tokenizer(t,e);this.tokenizers=t.splice?t:[t],e&&(this.doBuild=e),this.parse=function(t){for(this.src=t,this.ended=!1,this.tokens=[];this.next(),!this.ended;);return this.tokens},this.build=function(t,e){t&&this.tokens.push(this.doBuild?this.doBuild(t,e,this.tkn):t)},this.next=function(){var t,e=this;e.findMin(),t=e.src.slice(0,e.min),e.build(t,!1),e.src=e.src.slice(e.min).replace(e.tkn,function(t){return e.build(t,!0),""}),e.src||(e.ended=!0)},this.findMin=function(){var t,e,n=this,i=0;for(n.min=-1,n.tkn="";void 0!==(t=n.tokenizers[i++]);)-1!=(e=n.src[t.test?"search":"indexOf"](t))&&(-1==n.min||e<n.min)&&(n.tkn=t,n.min=e);-1==n.min&&(n.min=n.src.length)}}};
